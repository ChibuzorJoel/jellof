<div class="orders-container">
  <!-- Header -->
  <div class="page-header">
    <h1>üõçÔ∏è Order Management</h1>
    <p>Manage all orders</p>
  </div>

  <!-- Messages -->
  <div class="messages">
    <div class="alert alert-success" *ngIf="successMessage">
      ‚úì {{ successMessage }}
    </div>
    <div class="alert alert-error" *ngIf="errorMessage">
      ‚úó {{ errorMessage }}
    </div>
  </div>

  <!-- Status Filter Tabs -->
  <div class="status-tabs">
    <button
      *ngFor="let status of ['all','pending','processing','shipped','delivered','cancelled']"
      [class.active]="filterStatus === status"
      (click)="filterByStatus(status)">
      {{ status | titlecase }}
      <span class="count">{{ getStatusCount(status) }}</span>
    </button>
  </div>

  <!-- Search Bar -->
  <div class="search-bar">
    <input
      type="text"
      placeholder="Search by customer or product..."
      [(ngModel)]="searchQuery"
      (keyup)="onSearch()" />
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    Loading orders...
  </div>

  <!-- Orders Table -->
  <div *ngIf="!isLoading" class="orders-table">
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Phone</th>
          <th>Product</th>
          <th>Qty</th>
          <th>Total</th>
          <th>Status</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let order of filteredOrders">
          <td><strong>#{{ order._id?.slice(-6)?.toUpperCase() }}</strong></td>
          <td>{{ order.customer?.firstName }} {{ order.customer?.lastName }}</td>
          <td>{{ order.customer?.phone }}</td>
          <td>{{ order.items[0]?.productName }}</td>
          <td>{{ order.items[0]?.quantity }}</td>
          <td class="price">${{ order.totalAmount?.toFixed(2) }}</td>
          <td>
            <span class="status-badge" [style.backgroundColor]="getStatusColor(order.orderStatus)">
              {{ order.orderStatus | titlecase }}
            </span>
          </td>
          <td>{{ order.createdAt | date:'short' }}</td>
          <td><button class="btn-view" (click)="viewOrderDetails(order)">View</button></td>
        </tr>
      </tbody>
    </table>

    <!-- Empty -->
    <div *ngIf="filteredOrders.length === 0" class="empty-state">
      No orders found
    </div>
  </div>
</div>

<!-- ================= ORDER DETAILS MODAL ================= -->

<div class="modal-overlay" *ngIf="showOrderDetails" (click)="closeOrderDetails()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Order Details</h2>
      <button class="btn-close" (click)="closeOrderDetails()">‚úï</button>
    </div>

    <div class="modal-body" *ngIf="selectedOrder">
      <!-- Order Info -->
      <div class="info-section">
        <h3>Order Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Order ID:</label>
            <span>#{{ selectedOrder._id?.slice(-8)?.toUpperCase() }}</span>
          </div>
          <div class="info-item">
            <label>Date:</label>
            <span>{{ selectedOrder.createdAt | date:'medium' }}</span>
          </div>
          <div class="info-item">
            <label>Status:</label>
            <span class="status-badge" [style.backgroundColor]="getStatusColor(selectedOrder.orderStatus)">
              {{ selectedOrder.orderStatus | titlecase }}
            </span>
          </div>
        </div>
      </div>

      <!-- Customer Info -->
      <div class="info-section">
        <h3>Customer Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Name:</label>
            <span>{{ selectedOrder.customer?.firstName }} {{ selectedOrder.customer?.lastName }}</span>
          </div>
          <div class="info-item">
            <label>Phone:</label>
            <span>{{ selectedOrder.customer?.phone }}</span>
          </div>
          <div class="info-item">
            <label>Email:</label>
            <span>{{ selectedOrder.customer?.email }}</span>
          </div>
        </div>
      </div>

      <!-- Products -->
      <div class="info-section">
        <h3>Products</h3>
        <table class="items-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Qty</th>
              <th>Size</th>
              <th>Color</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of selectedOrder.items">
              <td>{{ item.productName }}</td>
              <td>${{ item.price?.toFixed(2) }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.size || 'N/A' }}</td>
              <td>{{ item.color || 'N/A' }}</td>
              <td>${{ (item.price * item.quantity)?.toFixed(2) }}</td>
            </tr>
          </tbody>
        </table>
        <div class="order-total">
          <strong>Total:</strong> ${{ selectedOrder.totalAmount?.toFixed(2) }}
        </div>
      </div>

      <!-- Notes -->
      <div class="info-section" *ngIf="selectedOrder?.notes">
        <h3>Notes</h3>
        <p>{{ selectedOrder?.notes }}</p>
      </div>

      <!-- Update Status -->
      <div class="info-section">
        <h3>Update Status</h3>
        <div class="status-buttons">
          <button
            *ngFor="let status of ['pending','processing','shipped','delivered','cancelled']"
            (click)="updateStatus(selectedOrder, status)"
            [class.active]="selectedOrder.orderStatus === status"
            [style.backgroundColor]="getStatusColor(status)">
            {{ status | titlecase }}
          </button>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-delete" (click)="deleteOrder(selectedOrder!)">
        Delete Order
      </button>
      <button class="btn-secondary" (click)="closeOrderDetails()">
        Close
      </button>
    </div>
  </div>
</div>
